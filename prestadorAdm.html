<!DOCTYPE html>
<html lang="pt-br">

<head>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</script>
    <meta charset="utf-8">
    <title>Administra√ß√£o de perfil</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="keywords">
    <meta content="" name="description">

    <!-- Favicon -->
    <link href="img/favicon.ico" rel="icon">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;600&family=Nunito:wght@600;700;800&display=swap" rel="stylesheet">

    <!-- Icon Font Stylesheet -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link href="lib/animate/animate.min.css" rel="stylesheet">
    <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
    <link href="lib/tempusdominus/css/tempusdominus-bootstrap-4.min.css" rel="stylesheet" />

    <!-- Customized Bootstrap Stylesheet -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Template Stylesheet -->
    <link href="css/style.css" rel="stylesheet">
    <!-- React e ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <!-- Babel para transpilar JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

</head>

<body>
    <!-- Spinner Start -->
    <div id="spinner" class="show bg-white position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center">
        <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
            <span class="sr-only">Loading...</span>
        </div>
    </div>



    <!-- Navbar & Hero Start -->
    <div class="container-fluid position-relative p-0">
        <nav class="navbar navbar-expand-lg navbar-light px-4 px-lg-5 py-3 py-lg-0">
            <a href="" class="navbar-brand p-0">
                <h1 class="text-primary m-0"id="nomeEmpresaTitulo"><i class="fa fa-map-marker-alt me-3"></i></h1>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
                <span class="fa fa-bars"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarCollapse">
                 <div class="collapse navbar-collapse" id="navbarCollapse">
        <div class="navbar-nav ms-auto py-0">
          <a href="index.html" class="nav-item nav-link active">In√≠cio</a>
          <a href="about.html" class="nav-item nav-link">Sobre N√≥s</a>
          <a href="contact.html" class="nav-item nav-link">Contato</a>
        </div>
        
      </div>
                <div class="btn btn-primary rounded-pill py-2 px-4" onclick={logout()}>Sair</div>
            </div>
        </nav>

        <div class="container-fluid bg-primary py-5 mb-5 hero-header">
            <div class="container py-5">
                <div class="row justify-content-center py-5">
                    <div class="col-lg-10 pt-lg-5 mt-lg-5 text-center">
                        <h1 class="display-3 text-white animated slideInDown">Administra√ß√£o de perfil</h1>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Navbar & Hero End -->
 <div class="container-xxl py-5 wow fadeInUp" data-wow-delay="0.1s">
        <div class="container">
            <div class="booking p-5">
                <div class="row g-5 align-items-center">
                    <div class="col-md-6 text-white">
                        <h6 class="text-white text-uppercase">Servi√ßos</h6>
                        <h1 class="text-white mb-4">Valorize o que voc√™ sabe fazer. Cadastre seus servi√ßos agora!</h1>
                        <p class="mb-4">Voc√™ tem talento, experi√™ncia e sabe fazer um bom trabalho ‚Äî agora √© hora de mostrar isso para quem realmente est√° procurando por voc√™.</p>
                        <p class="mb-4">Ao cadastrar os servi√ßos que voc√™ oferece, voc√™ amplia suas chances de ser encontrado por clientes reais, interessados exatamente no que voc√™ faz.</p>
						<p class="mb-4">Seja voc√™ eletricista, encanador, designer, fot√≥grafo, manicure ou qualquer outro profissional, existe algu√©m precisando da sua habilidade <strong>agora mesmo</strong>.</p>
                    </div>
                    <div class="col-md-6">
                        <h1 class="text-white mb-4">Cadastro de serv√ßos</h1>
               <!-- FORMUL√ÅRIO -->
<form id="servicoForm">
    <div class="row g-3">
        <div class="col-md-6">
            <div class="form-floating">
                <input type="text" class="form-control bg-transparent" id="nomeServico" placeholder="Nome do Servi√ßo">
                <label for="nome">Nome do servi√ßo</label>
            </div>
        </div>
        <div class="col-md-6">
            <div class="form-floating">
                <input type="text" class="form-control bg-transparent" id="valor" placeholder="Valor">
                <label for="valor">Valor</label>
            </div>
        </div>
        <div class="col-md-6">
            <div class="form-floating">
                <select class="form-select bg-transparent" id="prazo">
                    <option value="1">1 Dia</option>
                    <option value="2">2 Dias</option>
                    <option value="3">3 Dias</option>
                </select>
                <label for="prazo">Prazo</label>
            </div>
        </div>
        <div class="col-12">
            <div class="form-floating">
                <textarea class="form-control bg-transparent" placeholder="Descri√ß√£o" id="descricao" style="height: 100px"></textarea>
                <label for="descricao">Descri√ß√£o do servi√ßo</label>
            </div>
        </div>
        <div class="col-12">
            <button class="btn btn-outline-light w-100 py-3" type="submit">Cadastrar</button>
        </div>
    </div>
</form>
<div id="servicosContainer" style="margin-top: 2rem;">
  <h3 style="color: white; font-weight: bold;">üßæ Seus Servi√ßos</h3>
  <ul id="listaServicos" style="list-style: none; padding: 0;"></ul>
</div>
<!-- LISTA DE SERVI√áOS -->
<ul id="listaServicos" class="mt-4"></ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
 <div class="container-xxl py-5">
        <div class="container">
            <div class="text-center wow fadeInUp" data-wow-delay="0.1s">
                <h6 class="section-title bg-white text-center text-primary px-3">Informe seus dados</h6>
                 <!--<h1 class="mb-5">Contact For Any Query</h1> <!-->
            </div>
            <div class="row g-4">
                
                <center><div class="col-lg-4 col-md-12 wow fadeInUp" data-wow-delay="0.5s">
                    <center><div class="col-12">
    <div class="form-floating">
      <input type="text" class="form-control" id="nomeUsuario" placeholder="Seu Nome">
      <label for="nome">Seu Nome</label>
    </div>
  </div>

  <!-- Email -->
  <div class="col-12">
    <div class="form-floating">
      <input type="email" class="form-control" id="emailUsuario" placeholder="Seu Email">
      <label for="email">Email</label>
    </div>
  </div>

  <!-- Telefone -->
  <div class="col-md-12">
    <div class="form-floating">
      <input type="tel" class="form-control" id="telefone" placeholder="Seu Telefone">
      <label for="telefone">Telefone</label>
    </div>
  </div>

  <!-- Senha -->
  <div class="col-md-12">
    <div class="form-floating">
      <input type="password" class="form-control" id="senha" placeholder="Senha">
      <label for="senha">Senha</label>
    </div>
  </div>

  <!-- Confirmar Senha -->
  <div class="col-md-12">
    <div class="form-floating">
      <input type="password" class="form-control" id="senhaConfirm" placeholder="Confirme sua Senha">
      <label for="senhaConfirm">Confirme sua Senha</label>
    </div>
  </div>

  <!-- Nome da Empresa -->
  <div class="col-12">
    <div class="form-floating">
      <input type="text" class="form-control" id="nomeEmpresaInput" placeholder="Nome da Empresa">
      <label for="nome_empresa">Nome da Sua Empresa</label>
    </div>
  </div>

  <!-- Site -->
  <div class="col-12">
    <div class="form-floating">
      <input type="text" class="form-control" id="site" placeholder="Site da Empresa">
      <label for="site">Site da Empresa</label>
    </div>
  </div>

  <!-- Apresenta√ß√£o / T√≠tulo -->
  <div class="col-12">
    <div class="form-floating">
      <textarea class="form-control" placeholder="Breve apresenta√ß√£o" id="apresentacao" style="height: 100px"></textarea>
      <label for="apresentacao">Apresenta√ß√£o - Breve descri√ß√£o da sua atua√ß√£o</label>
    </div>
  </div>

  <!-- Descri√ß√£o / Marketing -->
  <div class="col-12">
    <div class="form-floating">
      <textarea class="form-control" placeholder="Descri√ß√£o detalhada" id="descricaoMark" style="height: 100px"></textarea>
      <label for="descricao">Marketing da sua empresa</label>
    </div>
  </div>

  <!-- Linkedin -->
  <div class="col-12">
    <div class="form-floating">
      <input type="text" class="form-control" id="linkedin" placeholder="LinkedIn">
      <label for="linkedin">Link do LinkedIn</label>
    </div>
  </div>

  <!-- Facebook -->
  <div class="col-12">
    <div class="form-floating">
      <input type="text" class="form-control" id="facebook" placeholder="Facebook">
      <label for="facebook">Link do Facebook</label>
    </div>
  </div>

  <!-- Instagram -->
  <div class="col-12">
    <div class="form-floating">
      <input type="text" class="form-control" id="instagram" placeholder="Instagram">
      <label for="instagram">Link do Instagram</label>
    </div>
  </div>

  <!-- YouTube -->
  <div class="col-12">
    <div class="form-floating">
      <input type="text" class="form-control" id="youtube" placeholder="YouTube">
      <label for="youtube">Link do YouTube</label>
    </div>
  </div>

  <!-- Foto de perfil -->
  <div class="col-12">
  <div class="col-12">
  <label for="fotoPerfil" style="display:block; border: 2px dashed #aaa; padding: 20px; text-align: center; cursor: pointer;">
    Arraste e solte sua foto de perfil aqui ou clique para selecionar
  </label>
  <input type="file" id="fotoPerfil" accept="image/*" style="display:none" />
  <div id="previewFoto" style="margin-top: 10px; margin-bottom: 10px;"></div>
  </div>
  <div onclick={validarSenha()} id="botaoCadastrar" class="btn btn-primary w-100 py-3">
  Salvar dados de sua empresa
</div>
</div></center>
                </div></center>
            </div>
        </div>
<!-- Planos(monetiz√ß√£o -->
 <div class="container-xxl py-5">
        <div class="container">
            <div class="text-center pb-4 wow fadeInUp" data-wow-delay="0.1s">
                <h6 class="section-title bg-white text-center text-primary px-3">Planos de destaque</h6>
                <h1 class="mb-5">3 Op√ß√µes</h1>
            </div>
            <div class="row gy-5 gx-4 justify-content-center">
                <div class="col-lg-4 col-sm-6 text-center pt-4 wow fadeInUp" data-wow-delay="0.1s">
                    <div class="position-relative border border-primary pt-5 pb-4 px-4">
                        <div class="d-inline-flex align-items-center justify-content-center bg-primary rounded-circle position-absolute top-0 start-50 translate-middle shadow" style="width: 100px; height: 100px;">
                            <i class="fa fa-globe fa-3x text-white"></i>
                        </div>
                        <h5 class="mt-4">Plano B√°sico - Presen√ßa Online Essencial</h5>
                        <hr class="w-25 mx-auto bg-primary mb-1">
                        <hr class="w-50 mx-auto bg-primary mt-0">
                        <p class="mb-0">
      <ul>
        <li>Perfil com foto e descri√ß√£o</li>
        <li>1 categoria de servi√ßo</li>
        <li>Exibi√ß√£o nos resultados padr√£o</li>
        <li>Link para contato direto</li>
      </ul>
      <p>"Comece com o p√© direito! Presen√ßa online simples, acess√≠vel e eficiente."</p></p>
                    </div>
                </div>
                <div class="col-lg-4 col-sm-6 text-center pt-4 wow fadeInUp" data-wow-delay="0.3s">
                    <div class="position-relative border border-primary pt-5 pb-4 px-4">
                        <div class="d-inline-flex align-items-center justify-content-center bg-primary rounded-circle position-absolute top-0 start-50 translate-middle shadow" style="width: 100px; height: 100px;">
                            <i class="fa fa-dollar-sign fa-3x text-white"></i>
                        </div>
                        <h5 class="mt-4">Plano Profissional - Destaque e Alcance</h5>
                        <hr class="w-25 mx-auto bg-primary mb-1">
                        <hr class="w-50 mx-auto bg-primary mt-0">
                        <p class="mb-0">
      <ul>
        <li>Tudo do Plano B√°sico</li>
        <li>Destaque nas buscas</li>
        <li>At√© 3 categorias de servi√ßo</li>
        <li>Galeria de fotos e v√≠deos</li>
        <li>Bot√£o de agendamento direto</li>
      </ul>
      <p>"Destaque-se da concorr√™ncia com mais visibilidade e convers√£o."</p></p>
                    </div>
                </div>
                <div class="col-lg-4 col-sm-6 text-center pt-4 wow fadeInUp" data-wow-delay="0.5s">
                    <div class="position-relative border border-primary pt-5 pb-4 px-4">
                        <div class="d-inline-flex align-items-center justify-content-center bg-primary rounded-circle position-absolute top-0 start-50 translate-middle shadow" style="width: 100px; height: 100px;">
                            <i class="fa fa-plane fa-3x text-white"></i>
                        </div>
                        <h5 class="mt-4">Plano Premium - Presen√ßa Total</h5>
                        <hr class="w-25 mx-auto bg-primary mb-1">
                        <hr class="w-50 mx-auto bg-primary mt-0">
                        <p class="mb-0"><ul>
        <li>Tudo do Plano Profissional</li>
        <li>Selo de verifica√ß√£o</li>
        <li>Divulga√ß√£o nas redes sociais</li>
        <li>Avalia√ß√µes em destaque</li>
        <li>Relat√≥rios mensais</li>
        <li>Suporte priorit√°rio</li>
      </ul></p>
	  <p>"Seja autoridade no seu setor com prest√≠gio e alcance m√°ximo."</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <button onclick="conectarGoogle()">Conectar com Google para utilizar a Agenda</button>
    <div id="agendamentos-root"></div>

    <!-- Footer Start -->
         <div class="container-fluid bg-dark text-light footer pt-5 mt-5 wow fadeIn" data-wow-delay="0.1s">
    <div class="container py-5">
      <div class="row g-5">
        <div class="col-lg-3 col-md-6">
          <h4 class="text-white mb-3">I.N.D.C.A</h4>
          <a class="btn btn-link" href="">Sobre N√≥s</a>
          <a class="btn btn-link" href="">Pol√≠tica de Privacidade</a>
          <a class="btn btn-link" href="">FAQs & Ajuda</a>
        </div>
        <div class="col-lg-3 col-md-6">
          <h4 class="text-white mb-3">Contato</h4>
          <p class="mb-2"><i class="fa fa-phone-alt me-3"></i>+55 11 96372-6508</p>
          <p class="mb-2"><i class="fa fa-envelope me-3"></i>contato@indca.com.br</p>
        </div>
      </div>
    </div
 

  
    <a href="#" class="btn btn-lg btn-primary btn-lg-square back-to-top"><i class="bi bi-arrow-up"></i></a>


    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="lib/wow/wow.min.js"></script>
    <script src="lib/easing/easing.min.js"></script>
    <script src="lib/waypoints/waypoints.min.js"></script>
    <script src="lib/owlcarousel/owl.carousel.min.js"></script>
    <script src="lib/tempusdominus/js/moment.min.js"></script>
    <script src="lib/tempusdominus/js/moment-timezone.min.js"></script>
    <script src="lib/tempusdominus/js/tempusdominus-bootstrap-4.min.js"></script>
    <!-- Seus scripts -->
    <script src="lib/owlcarousel/owl.carousel.min.js"></script>
    <script src="lib/tempusdominus/js/moment.min.js"></script>
    <script src="lib/tempusdominus/js/moment-timezone.min.js"></script>
    <script src="lib/tempusdominus/js/tempusdominus-bootstrap-4.min.js"></script>

    <!-- Toastify -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    
    <style>
        /* Personaliza√ß√£o do estilo do toast */
        .toastify {
            font-size: 20px; /* Aumenta o tamanho da fonte */
            font-family: Arial, sans-serif;
            border-radius: 50px;
        }
    </style>
    <!-- Template Javascript -->
    <script src="js/main.js"></script>
    <script>
  function conectarGoogle() {
    const email = localStorage.getItem('email'); // ou uma vari√°vel qualquer
    if (!email) {
      alert('Usu√°rio n√£o est√° logado!');
      return;
    }

    const url = `https://www.indca.com.br/auth/google?email=${encodeURIComponent(email)}`;
    window.location.href = url;
  }
  </script>
  <script type="text/babel">
  const { useEffect, useState } = React;

  function Agendamentos() {
    const [agendamentos, setAgendamentos] = useState([]);
    const [loading, setLoading] = useState(true);
    const [emailPrestador, setEmailPrestador] = useState('');

    useEffect(() => {
      async function carregarEmailEAgendamentos() {
        const token = localStorage.getItem('token');
        if (!token) {
          setLoading(false);
          return;
        }

        // Decodificar token para pegar id
        let userId;
        try {
          const base64Url = token.split('.')[1];
          const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
          const jsonPayload = decodeURIComponent(atob(base64).split('').map(c =>
            '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)
          ).join(''));
          userId = JSON.parse(jsonPayload).id;
        } catch (e) {
          console.error('Token inv√°lido:', e);
          setLoading(false);
          return;
        }

        if (!userId) {
          setLoading(false);
          return;
        }

        try {
          // Buscar email do usu√°rio via API
          const resUser = await axios.get(`https://marketplace-production-4ad4.up.railway.app/usuarios/${userId}`, {
            headers: { Authorization: `Bearer ${token}` }
          });
          const email = resUser.data.email;
          setEmailPrestador(email);

          // Buscar agendamentos com o email do prestador
          const resAgendamentos = await axios.get(`https://marketplace-production-4ad4.up.railway.app/agendamentos?emailPrestador=${email}`, {
            headers: { Authorization: `Bearer ${token}` }
          });
          setAgendamentos(resAgendamentos.data);
        } catch (err) {
          console.error('Erro ao carregar dados:', err);
        } finally {
          setLoading(false);
        }
      }

      carregarEmailEAgendamentos();
    }, []);

    const cancelarAgendamento = async (id) => {
      const token = localStorage.getItem('token');
      try {
        await axios.delete(`https://marketplace-production-4ad4.up.railway.app/agendamentos/${id}`, {
          headers: { Authorization: `Bearer ${token}` }
        });
        setAgendamentos(prev => prev.filter(a => a.id !== id));
      } catch (error) {
        console.error('Erro ao cancelar agendamento', error);
      }
    };

    if (loading) return <p>Carregando agendamentos...</p>;
    if (!emailPrestador) return <p>Usu√°rio n√£o autenticado.</p>;
    if (agendamentos.length === 0) return <p>Nenhum agendamento encontrado.</p>;

    return (
      <div>
        <h2>Seus Agendamentos</h2>
        <ul>
          {agendamentos.map(ag => (
            <li key={ag.id} style={{ marginBottom: '10px' }}>
              Cliente: {ag.cliente} | Data: {new Date(ag.inicio).toLocaleDateString()} | In√≠cio: {new Date(ag.inicio).toLocaleTimeString()} | Fim: {new Date(ag.fim).toLocaleTimeString()}
              <button onClick={() => cancelarAgendamento(ag.id)} style={{ marginLeft: '10px' }}>Cancelar</button>
            </li>
          ))}
        </ul>
      </div>
    );
  }

  ReactDOM.createRoot(document.getElementById('agendamentos-root')).render(<Agendamentos />);
</script>

<script>

document.addEventListener("DOMContentLoaded", async () => {
  const token = localStorage.getItem('token');
  const idUsuario = localStorage.getItem('id');
  let idEmpresa = localStorage.getItem("idEmpresa");

  if (!token || !idUsuario) {
    Toastify({
      text: "Usu√°rio n√£o est√° logado! üò•",
      duration: 5000,
      gravity: "top",
      position: "center",
      backgroundColor: "#1f1f1f",
    }).showToast();
    return;
  }

  try {
    // Buscar dados do usu√°rio
    const responseUsuario = await axios.get(`https://marketplace-production-4ad4.up.railway.app/usuarios/${idUsuario}`, {
      headers: { Authorization: `Bearer ${token}` }
    });

    const usuario = responseUsuario.data;
    document.getElementById('nomeUsuario').value = usuario.nome || '';
    document.getElementById('emailUsuario').value = usuario.email || '';
    document.getElementById('telefone').value = usuario.telefone || '';

    // Buscar empresa se n√£o tiver idEmpresa salvo
    if (!idEmpresa) {
      const responseEmpresa = await axios.get(`https://marketplace-production-4ad4.up.railway.app/empresas/usuario/${idUsuario}`, {
        headers: { Authorization: `Bearer ${token}` }
      });
      const empresa = responseEmpresa.data;
      idEmpresa = empresa.id;
      localStorage.setItem("idEmpresa", idEmpresa);
      console.log(empresa);
      document.getElementById("nomeEmpresaTitulo").textContent = empresa.nome_empresa || '';
      document.getElementById("nomeEmpresaInput").value = empresa.nome_empresa || '';
      document.getElementById("apresentacao").value = empresa.apresentacao || '';
      document.getElementById("descricaoMark").value = empresa.descricao || '';
      document.getElementById("site").value = empresa.site || '';
      document.getElementById("instagram").value = empresa.instagram || '';
      document.getElementById("linkedin").value = empresa.linkedin || '';
      document.getElementById("facebook").value = empresa.facebook || '';
      document.getElementById("youtube").value = empresa.youtube || '';

      if (empresa.foto_perfil) {
        const preview = document.getElementById("previewFoto");
        preview.innerHTML = `
          <img src="https://marketplace-production-4ad4.up.railway.app/uploads/${empresa.foto_perfil}" 
               alt="Foto de perfil" 
               style="max-width: 200px; max-height: 200px; object-fit: cover;" />
        `;
      }
    } else {
      // Buscar empresa usando idEmpresa salvo
      const responseEmpresa = await axios.get(`https://marketplace-production-4ad4.up.railway.app/empresas/${idEmpresa}`, {
        headers: { Authorization: `Bearer ${token}` }
      });
      const empresa = responseEmpresa.data;
      idEmpresa = empresa.id;
      localStorage.setItem("idEmpresa", idEmpresa);
      console.log(empresa);
      document.getElementById("nomeEmpresaTitulo").textContent = empresa.nome_empresa || '';
      document.getElementById("nomeEmpresaInput").value = empresa.nome_empresa || '';
      document.getElementById("apresentacao").value = empresa.apresentacao || '';
      document.getElementById("descricaoMark").value = empresa.descricao || '';
      document.getElementById("site").value = empresa.site || '';
      document.getElementById("instagram").value = empresa.instagram || '';
      document.getElementById("linkedin").value = empresa.linkedin || '';
      document.getElementById("facebook").value = empresa.facebook || '';
      document.getElementById("youtube").value = empresa.youtube || '';

      if (empresa.foto_perfil) {
        const preview = document.getElementById("previewFoto");
        preview.innerHTML = `
          <img src="https://marketplace-production-4ad4.up.railway.app/uploads/${empresa.foto_perfil}" 
               alt="Foto de perfil" 
               style="max-width: 200px; max-height: 200px; object-fit: cover;" />
        `;
      }
      if (empresa.id !== idEmpresa) {
        idEmpresa = empresa.id;
        localStorage.setItem("idEmpresa", idEmpresa);
      }
    }
  
    // Carregar servi√ßos existentes da empresa usando idEmpresa
    const responseServicos = await axios.get(`https://marketplace-production-4ad4.up.railway.app/servicos/empresa/${idEmpresa}`, {
      headers: { Authorization: `Bearer ${token}` }
    });
    responseServicos.data.forEach(servico => adicionarNaLista(servico));

  } catch (error) {
    console.error("Erro ao buscar dados:", error);
  }
})
  // Evento do formul√°rio de servi√ßos
  document.getElementById("servicoForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    
    const token = localStorage.getItem("token");
    const idEmpresa = localStorage.getItem("idEmpresa");
    const titulo = document.getElementById("nomeServico").value;
    const valor = document.getElementById("valor").value;
    const prazo = document.getElementById("prazo").value;
    const descricao_servico = document.getElementById("descricao").value;

    if (!token || !idEmpresa) {
      Toastify({
        text: "Usu√°rio n√£o autenticado ou empresa n√£o identificada. üò•",
        duration: 5000,
        gravity: "top",
        position: "center",
        backgroundColor: "#1f1f1f",
      }).showToast();
      return;
    }
    if (!titulo || !valor || !prazo || !descricao_servico) {
    Toastify({
        text: "Preencha todos os campos obrigat√≥rios! üòì",
        duration: 5000,
        gravity: "top",
        position: "center",
        backgroundColor: "#dc3545",
    }).showToast();
    return;
    }
    // Montar o objeto com os nomes de campos corretos do backend
    const novoServico = { 
      empresa_id: idEmpresa, 
      titulo, 
      descricao_servico, 
      valor: parseFloat(valor), 
      prazo: parseInt(prazo, 10)
    };

    try {
      const response = await axios.post(
        "https://marketplace-production-4ad4.up.railway.app/servicos",
        novoServico,
        { headers: { Authorization: `Bearer ${token}` } }
      );
    
      adicionarNaLista(response.data);
        Toastify({
        text: "Servi√ßo adicionado com sucesso. üòÑ",
        duration: 5000,
        gravity: "top",
        position: "center",
        backgroundColor: "#28a745",
      }).showToast();
      document.getElementById("servicoForm").reset();
    } catch (error) {
      console.error("Erro ao cadastrar:", error);
      Toastify({
        text: "Erro ao cadastrar servi√ßo. üò•",
        duration: 5000,
        gravity: "top",
        position: "center",
        backgroundColor: "#1f1f1f",
      }).showToast();
    }
  });

  // Fun√ß√£o para adicionar servi√ßo na lista
function adicionarNaLista(servico) {
  const lista = document.getElementById("listaServicos");

  const li = document.createElement("li");
  li.innerHTML = `
    <div style="
      background-color: #2c2c2c;
      color: white;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    ">
      <div>
        <strong>${servico.titulo}</strong><br>
        R$${(Number(servico.valor) || 0).toFixed(2)} ‚Ä¢ ${servico.prazo} dias<br>
        ${servico.descricao_servico || ''}
      </div>
      <button class="btn btn-danger btn-sm" style="margin-left: 20px;">
        Excluir
      </button>
    </div>
  `;

  const btn = li.querySelector("button");
btn.onclick = async () => {
  const token = localStorage.getItem("token"); // <-- necess√°rio aqui
  try {
    await axios.delete(`https://marketplace-production-4ad4.up.railway.app/servicos/${servico.id}`, {
      headers: { Authorization: `Bearer ${token}` }
    });
    li.remove();
    Toastify({
      text: "Servi√ßo deletado!",
      duration: 5000,
      gravity: "top",
      position: "center",
      backgroundColor: "#dc3545"
    }).showToast();
  } catch (error) {
    Toastify({
      text: "Erro ao excluir!",
      duration: 5000,
      gravity: "top",
      position: "center",
      backgroundColor: "#dc3545"
    }).showToast();
    console.error("Erro ao excluir:", error);
  }
};


  lista.appendChild(li);
}


// Resto do c√≥digo para senha, fotoPerfil e atualiza√ß√£o continua igual, s√≥ corrigi strings e Authorization abaixo:

const senha = document.getElementById('senha');
const senhaConfirm = document.getElementById('senhaConfirm');
const fotoPerfilInput = document.getElementById('fotoPerfil');
const botao = document.getElementById('botaoCadastrar');

// Valida se as senhas coincidem
function validarSenha() {
  if (senha.value !== senhaConfirm.value) {
    Toastify({
      text: "‚ùå As senhas n√£o coincidem!",
      duration: 5000,
      gravity: "top",
      position: "center",
      backgroundColor: "#1f1f1f",
    }).showToast();
    return false;
  } else {
    atualizarTudo();
    return true;
  }
}

// Atualiza os dados do usu√°rio e da empresa
async function atualizarTudo() {
  botao.disabled = true;

  const usuario_id = localStorage.getItem("id");
  const empresa_id = localStorage.getItem("idEmpresa");
  const token = localStorage.getItem("token");

  if (!usuario_id || !empresa_id || !token) {
    Toastify({
      text: "‚ö†Ô∏è Sess√£o inv√°lida. Fa√ßa login novamente.",
      duration: 5000,
      gravity: "top",
      position: "center",
      backgroundColor: "#1f1f1f",
    }).showToast();
    window.location.href = 'login.html';
    return;
  }

  try {
    // Atualizar dados do usu√°rio
    const dadosUsuario = {
      nome: document.getElementById('nomeUsuario').value,
      email: document.getElementById('emailUsuario').value,
      telefone: document.getElementById('telefone').value,
      senha: senha.value // Inclui nova senha se quiser permitir altera√ß√£o
    };

    await axios.put(
      `https://marketplace-production-4ad4.up.railway.app/usuarios/${usuario_id}`,
      dadosUsuario,
      {
        headers: {
          Authorization: `Bearer ${token}`
        }
      }
    );

    // Atualizar dados da empresa
    const empresaFormData = new FormData();
    empresaFormData.append('nome_empresa', document.getElementById('nomeEmpresaInput').value);
    empresaFormData.append('apresentacao', document.getElementById('apresentacao').value);
    empresaFormData.append('descricao', document.getElementById('descricaoMark').value);
    empresaFormData.append('site', document.getElementById('site').value);
    empresaFormData.append('facebook', document.getElementById('facebook').value);
    empresaFormData.append('linkedin', document.getElementById('linkedin').value);
    empresaFormData.append('instagram', document.getElementById('instagram').value);
    empresaFormData.append('youtube', document.getElementById('youtube').value);

    const arquivoFoto = fotoPerfilInput.files[0];
    if (arquivoFoto) {
      empresaFormData.append('foto_perfil', arquivoFoto);
    }

    await axios.put(
      `https://marketplace-production-4ad4.up.railway.app/empresas/${empresa_id}`,
      empresaFormData,
      {
        headers: {
          Authorization: `Bearer ${token}`,
          "Content-Type": "multipart/form-data"
        }
      }
    );

    Toastify({
      text: "üòÑ Dados atualizados com sucesso!",
      duration: 5000,
      gravity: "top",
      position: "center",
      backgroundColor: "#28a745",
    }).showToast();
  } catch (error) {
    console.error("Erro ao atualizar:", error);
    Toastify({
      text: "‚ùå Erro ao atualizar os dados. Verifique os campos e tente novamente.",
      duration: 5000,
      gravity: "top",
      position: "center",
      backgroundColor: "#1f1f1f",
    }).showToast();
  } finally {
    botao.disabled = false;
  }
}

function logout() {
  // Limpa tudo do localStorage
  localStorage.clear();

  // Redireciona para a p√°gina inicial
  window.location.href = 'index.html';
}
</script>




</body>

</html>